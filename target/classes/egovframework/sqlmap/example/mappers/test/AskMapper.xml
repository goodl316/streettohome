<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="egovframework.sth.domain.ask.mapper.AskMapper">

	<resultMap
		type="egovframework.sth.domain.ask.domain.AskDTO" id="AskDTO" />
		
	<select id="selAskList" resultMap="AskDTO">
		SELECT ak_no, ak_name, ak_title, ak_ctnt, ak_dt, ak_idx, ak_dept
		FROM ask
		WHERE ak_del = 0
		ORDER BY ak_idx DESC, ak_dept ASC
	</select>
	
	<select id="selAsk" resultMap="AskDTO">
		SELECT * 
		FROM ask
		WHERE ak_idx = #{ak_idx}
	</select>
	
	<select id="selAskAdmin" resultMap="AskDTO">
		SELECT * 
		FROM ask
		WHERE ak_no = #{ak_no}
	</select>
	
	<insert id="insAsk">
		INSERT INTO ask
		(ak_no, ak_name, ak_title, ak_pw, ak_ctnt, ak_idx)
		VALUES(
		(SELECT NEXTVAL(ask_seq)), 
		#{ak_name}, 
		#{ak_title}, 
		#{ak_pw}, 
		#{ak_ctnt}, 
		(SELECT LASTVAL(ask_seq))
		)
	</insert>
	
	<insert id="insAns">
		INSERT INTO ask
		(ak_no, ak_name, ak_title, ak_pw, ak_ctnt, ak_idx, ak_dept)
		VALUES(
		(SELECT NEXTVAL(ask_seq)),
		"관리자",
		#{ak_title}, 
		(SELECT A.ak_pw FROM ask AS A WHERE ak_no = #{ak_idx}), 
		#{ak_ctnt}, 
		#{ak_idx},
		(SELECT B.ak_dept FROM ask AS B WHERE ak_no = #{ak_idx}) + 1)
	</insert>
	
	<update id="updAsk">
		UPDATE ask
		SET ak_title = #{ak_title},
		ak_ctnt = #{ak_ctnt}
		WHERE ak_no = #{ak_no}
	</update>
	
	<update id="updAns">
		UPDATE ask
		SET	ak_ctnt = #{ak_ctnt}
		WHERE ak_no = #{ak_no}
	</update>
	
	<update id="delAsk">
		UPDATE ask
		SET ak_del = 1
		WHERE ak_no = #{ak_no}
	</update>
</mapper>
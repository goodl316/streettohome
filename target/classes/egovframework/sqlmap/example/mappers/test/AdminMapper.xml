<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="egovframework.sth.domain.admin.mapper.AdminMapper">

	<resultMap
		type="egovframework.sth.domain.admin.domain.AdminDTO" id="AdminDTO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.MemberDTO" id="MemberDTO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.AskDTO" id="AskDTO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.BoardDTO" id="BoardDTO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.BoardVO" id="BoardVO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.ReportVO" id="ReportVO" />
	<resultMap
		type="egovframework.sth.domain.admin.domain.BannerDTO" id="BannerDTO" />


	<insert id="insreport">
		insert into report
		(b_no,m_no,rp_ctnt)
		value(
		#{b_no},#{m_no},"신고사유")
	</insert>

	<select id="selMember" resultMap="MemberDTO">
		select
		a.m_no,a.m_name,a.m_email,a.m_dt
		,(select count(*) from report where
		m_no = a.m_no) as warning
		from member a where a.m_state = #{m_state}
		and m_auth = 1
		LIMIT #{firstIndex}, #{recordCountPerPage}
	</select>
	
	<select id="selCountMember" resultType="int">
		SELECT COUNT(*) 
		FROM member 
		WHERE m_state = #{m_state} AND m_auth = 1;
	</select>
	
	<select id="bannerList" resultMap="BannerDTO">
		select* from banner;
	</select>
	<select id="selinfo" resultMap="BannerDTO">
		select ba_no, ba_img1 from banner where ba_no = #{ba_no}
	</select>

	<select id="selBoard" resultMap="BoardDTO">
		select
		a.b_no,a.b_title,a.b_auth,a.b_dt,a.b_tt,b.an_type1 from board a
		left
		join animal_info b
		on a.b_no = b.b_no
		where a.b_del =0 and b.an_type1=
		#{an_type1}
	</select>

	<select id="delBoardList" resultMap="BoardDTO">
		select
		a.b_no,a.b_title,a.b_auth,a.b_dt,a.b_tt,b.an_type1 from board a
		left
		join animal_info b
		on a.b_no = b.b_no
		where a.b_del =1
	</select>

	<select id="selReport" resultMap="ReportVO">
		<if test="an_type1 == null">
			select a.rp_no,a.b_no,a.rp_del,a.rp_dt,
			(select m_name from member where m_no=a.m_no) as wr_no,
			a.rp_ctnt,b.b_title,
			c.an_type1 from
			report a
			left
			join board b
			on a.b_no = b.b_no
			left join animal_info c
			on a.b_no =
			c.b_no
			left join member d
			on a.m_no = d.m_no
			where a.rp_del = 0;
			
		</if>
		<if test="an_type1 != null ">
			select a.rp_no,a.b_no,a.rp_del,a.rp_dt,
			(select m_name from member where m_no=a.m_no) as wr_no,
			a.rp_ctnt,b.b_title,
			c.an_type1,d.m_name from
			report
			a
			left join board b
			on a.b_no = b.b_no
			left join animal_info c
			on a.b_no
			= c.b_no
			left join member d
			on a.m_no = d.m_no;
			where c.an_type1 =
			#{an_type1} and a.rp_del = 0;
		</if>
	</select>
	<select id="selAskList" resultMap="AskDTO">
		select a.ak_no,a.ak_title,a.ak_ctnt,a.ak_dt,a.m_no,b.m_name from ask a
		left join member b
		on a.m_no = b.m_no
		where a.ak_del = 0
	</select>

	<select id="selAsk" resultMap="AskDTO">
		select a.ak_no,a.ak_title,a.ak_ctnt,a.ak_dt,b.m_name,b.m_email from ask a
		left join member b
		on a.m_no = b.m_no
		where ak_no = #{ak_no}
	</select>

	<update id="delBoard">
		update board
		set b_del = 1
		where b_no = #{b_no}
	</update>
	<update id="delMember">
		update member
		set m_state = 3
		where m_no = #{m_no}
	</update>

	<update id="delAsk">
		update ask
		set ak_del =1
		where ak_no = #{ak_no}
	</update>

	<update id="updBannerImg">
		update banner
		set ba_img1 = #{ba_img1}
		where ba_no = #{ba_no};
	</update>
	
	<update id="delReport">
	update report
	set rp_del = 1
	where rp_no;
	</update>
	
	
</mapper>